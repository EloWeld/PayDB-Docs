# [Домой](./README.MD)
### Описание схемы `top_up`

## Таблицы

### `merch_scheme`
| Название поля | Тип данных | Описание поля          |
|----------------|------------|------------------------|
| idmerch        | int2       | Первичный ключ, автоинкрементный идентификатор мерчанта |
| accesuaries    | jsonb      | JSON с аксессуарами и дополнительными настройками |
| login          | varchar(50)| Логин мерчанта |
| notification   | jsonb      | JSON с данными о настройках уведомлений |
| enable         | bool       | Статус активности мерчанта |

### `order`
| Название поля | Тип данных       | Описание поля          |
|----------------|------------------|------------------------|
| param          | jsonb            | JSON с параметрами заказа |
| id_paybank     | int4             | Идентификатор платежной системы |
| enable         | status_order     | Статус заказа (новый, оплачен) |
| datetime       | timestamp(6)     | Время создания заказа |
| id_order       | varchar(50)      | Уникальный идентификатор заказа |

---

## Перечисления (Enums)
**status_order**
- `new`
- `paid`

#### Функции

---

**`f_notify_paysys()`**
- Триггерная функция, отправляющая уведомления о изменениях в платежной системе.

**`f_order(xjson json)`**
- Создает заказ на основе входных данных в формате JSON и возвращает статус операции.

**`f_order_id(xid_order character)`**
- Проверяет статус заказа по идентификатору и возвращает текущий статус.

**`f_order_status(xid_order character)`**
- Обновляет статус заказа после изменения в платежной системе и возвращает обновленный статус.

**`f_topup()`**
- Возвращает список активных мерчантов в системе в формате JSON.

#### Триггеры

---

**`f_notify_paysys`**
- Применяется после изменения в заказе.
- Вызывает `f_notify_paysys` для отправки уведомления.
